#!/bin/bash
# Git pre-commit hook - auto-sync before committing

# Skip if SKIP_SYNC is set
if [[ -n "$SKIP_SYNC" ]]; then
    exit 0
fi

echo "Running pre-commit sync..."
./sync.sh

# Only proceed if there are changes to commit
if git diff-index --quiet HEAD -- 2>/dev/null; then
    # No changes after sync, allow commit
    exit 0
fi

# Ask if user wants to include the synced changes
echo ""
echo "New changes detected from sync!"
echo "These will be included in this commit."
read -p "Continue? (Y/n) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]] && [[ -n $REPLY ]]; then
    echo "Commit cancelled. Run 'git status' to see synced changes."
    exit 1
fi

# Add the synced changes
git add .

exit 0
